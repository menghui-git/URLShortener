<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>URL Shortener</title>
</head>
<body>

    <div class="center">
        <input type="text" id="url" name="url" placeholder="Enter URL Here">
        <button type="submit"> Shorten </button>
        <p id="msg"></p>
    </div>

    <script>
        const btn = document.querySelector('button');

        function shortenURL() {
          const xhr = new XMLHttpRequest();
          const url = "http://localhost/api/shorten";  // TODO: put in config
          xhr.open('POST', url, true);
          xhr.setRequestHeader("Content-type", "application/json");

          const url_to_shorten = document.getElementById('url').value
          const payload = JSON.stringify({"url": url_to_shorten})

          xhr.onreadystatechange = function() {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                data = JSON.parse(xhr.responseText)
                var msg = ""
                if (xhr.status == 400) {
                    document.getElementById('msg').innerHTML = data['msg'];
                } else {
                    const shorten_url = data['shorten_url']
                    document.getElementById('msg').innerHTML =
                        url_to_shorten + " is converted to <a target='_blank' rel='noopener noreferrer' href='" + shorten_url + "'>" + shorten_url + "</a>";
                }
            }
          }
          xhr.send(payload)
        }

        btn.addEventListener('click', function(){
            shortenURL();
        })
    </script>

    <style>
        .center {
          position: absolute;
          left: 42%;
          top: 40%;
        }
    </style>

</body>
</html>